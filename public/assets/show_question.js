function initTopicAutocompleteForReclassifying(){var b=new TopicAutocomplete("#topic-autocomplete-input","#topic-autocomplete-suggestions");var d=$("#question .body-col ul.topic-list");var c=location.href;function a(){d.find(".remove").hide();$("#topic-autocomplete-input").hide();$(".add-topic").hide();$(".cancel-reclassify").hide();if(d.find("li").length==0){$(".reclassify .empty").show();$(".reclassify .not-empty").hide()}else{$(".reclassify .empty").hide();$(".reclassify .not-empty").show()}$(".retag").show();$(".topic-title").removeClass("reduced")}function e(){d.find(".remove").show();$("#topic-autocomplete-input").show();$(".add-topic").show();$(".cancel-reclassify").show();$(".retag").hide();$(".topic-title").addClass("reduced")}a();$(".reclassify").click(function(){e();return false});$(".add-topic").live("click",function(){if(b.isActive){b.returnDefault()}return false});$(".cancel-reclassify").live("click",function(){a();return false});$("a.remove",d).live("click",function(){var f=$(this);$.getJSON(f.attr("href"),function(g){f.closest("li").remove()});return false});b.action=function(f){$.getJSON(c+"/classify?topic="+encodeURIComponent(f),function(g){if(g.success){d.find(".retag").before(g.box);Utils.poshytipfy()}});b.clear()}}$(document).ready(function(){initTopicAutocompleteForReclassifying();$("#close_question_form").hide();$(".comments_wrapper").hide();$("input#question_title").focus();$(".modal .close").live("click",function(){$.colorbox.close();return false});$("#body").live("keyup",function(){var c=$(this);var a=c.val().length;var e=c.attr("data-maxlength");var f=$(".charcount");var g=$(".modal :submit");var d=f.find(".charsleft");var b=f.find("span:last");cl=e-a;if(cl>=0){if(cl>1||cl==0){b.html("caracteres restantes")}else{b.html("caracter restante")}f.removeClass("negative-counter");g.removeAttr("disabled")}else{if(cl==-1){b.html("caracter excedente")}else{b.html("caracteres excedentes")}f.addClass("negative-counter");g.attr("disabled","disabled");cl=-cl}d.html(cl)});Utils.clickObject(".share-question-widget input[type=submit]",function(){return{success:function(a){$.colorbox.close()},error:function(a){if(a.status=="needs_permission"){Utils.modal({html:a.html})}}}});Utils.clickObject(".share .facebook, .share .twitter",function(){return{success:function(a){Utils.modal({html:a.html})},error:function(a){if(a.status=="needs_connection"){Utils.modal({html:a.html})}}}});Utils.clickObject(".comment .comment-votes form.vote-up-comment-form input[name=vote_up]",function(){var a=$(this);var b=$(this).closest("form");a.hide();return{data:b.serialize()+"&"+a.attr("name")+"=1",success:function(c){if(c.vote_state=="deleted"){a.attr("src","/images/dialog-ok.png")}else{a.attr("src","/images/dialog-ok-apply.png")}a.parents(".comment-votes").children(".votes_average").html(c.average)},complete:function(){a.show()}}});Utils.clickObject("form.mainAnswerForm .button",function(){var b=$(this).parents("form");var c=$("#answers .hentry");var a=$(this);return{success:function(f){window.onbeforeunload=null;var e=$(f.html);var d=e.find(".entry-content");e.find(".comments_wrapper").hide();c.append(e);highlightEffect(e);$("#new-answer-wrapper").html(f.form_message);MathJax.Hub.Queue(["Typeset",MathJax.Hub,e[0]])},error:function(d){if(d.status=="unauthenticate"){window.onbeforeunload=null;window.location="/users/login"}}}});Utils.clickObject("form.commentForm .button",function(){var b=$(this).parents("form");var c=$(this).closest(".commentable").find(".comments");var a=$(this);return{success:function(e){var d=b.find("textarea");window.onbeforeunload=null;var f=$(e.html);c.append(f);c.closest(".commentable").find(".ccontrol").replaceWith(e.count);highlightEffect(f);d.val("");MathJax.Hub.Queue(["Typeset",MathJax.Hub,f[0]])},error:function(d){if(d.status=="unauthenticate"){window.onbeforeunload=null;window.location="/users/login"}}}});$(".edit_comment").live("click",function(){var b=$(this).parents(".comment");var a=$(this);a.hide();$.ajax({url:$(this).attr("href"),dataType:"json",type:"GET",data:{format:"js"},success:function(f){b=b.append(f.html);a.hide();var e=b.find("form.form");e.find(".cancel_edit_comment").click(function(){e.remove();a.show();return false});var d=e.find("input[type=submit]");var c=e.find("textarea");e.submit(function(){d.attr("disabled",true);$.ajax({url:e.attr("action"),dataType:"json",type:"PUT",data:e.serialize()+"&format=js",success:function(g,h){if(g.success){b.find(".markdown").html("<p>"+g.body+"</p>");e.remove();a.show();highlightEffect(b);showMessage(g.message,"notice");window.onbeforeunload=null}else{showMessage(g.message,"error");if(g.status=="unauthenticate"){window.onbeforeunload=null;window.location="/users/login"}}},error:manageAjaxError,complete:function(g,h){d.attr("disabled",false)}});return false})},error:manageAjaxError,complete:function(c,d){a.show()}});return false});$(".flag_form .cancel").live("click",function(){$("#question_flag_div").html("");return false});$(".answer .flag-link").live("click",function(){var b=$(this);var a=b.parents(".controls");$.ajax({url:$(this).attr("href"),dataType:"json",type:"GET",success:function(c){a.parents(".answer").find("#answer_flag_div").html(c.html);return false}});return false});$("#question_flag_link.flag-link").click(function(){$.ajax({url:$(this).attr("href"),dataType:"json",type:"GET",success:function(a){$("#question_flag_div").html(a.html);$("#request_close_question_form").slideUp();$("#close_question_form").slideUp();return false}});return false});$(".question-action").live("click",function(e){var d=$(this);if(!d.hasClass("busy")){d.addClass("busy");var c=d.attr("href");var g=d.attr("data-undo");var f=d.attr("title");var h=d.attr("data-title");var b=d.children("img");var a=$(d.attr("data-counter"));$.getJSON(c+".js",function(i){if(i.success){d.attr({href:g,"data-undo":c,title:h,"data-title":f});b.attr({src:b.attr("data-src"),"data-src":b.attr("src")});if(typeof(i.increment)!="undefined"){a.text(parseFloat($.trim(a.text()))+i.increment)}showMessage(i.message,"notice")}else{showMessage(i.message,"error");if(i.status=="unauthenticate"){window.onbeforeunload=null;window.location="/users/login"}}d.removeClass("busy")},"json")}return false});$(".ccontrol-link").live("click",function(){$(this).closest(".commentable").find(".comments_wrapper").slideToggle("slow");return false})});